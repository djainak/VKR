
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="~/Content/Style/js/jquery-ui.js"></script>
    <link rel="stylesheet" href="~/Content/Style/css/jquery-ui.css" />
    <link href="~/Content/Style/css/mainstyle.css" rel="stylesheet" />
    <title>Заказы</title>
</head>
<body>
    <div>
        <div>
            <nav role='navigation'>
                <ul>
                    <li><a href="../Admin/Home?UserId=@ViewBag.UserID">О точке питания</a></li>
                    <li><a href="../Admin/MenuList?UserId=@ViewBag.UserID">Меню</a></li>
                    <li><a href="../Admin/OrdersPage?UserId=@ViewBag.UserID">Заказы</a></li>
                    <li><a href="../Admin/PersonalAccount?UserId=@ViewBag.UserID">Личный кабинет</a></li>
                    <li><a href="../Admin/ListUsers?UserId=@ViewBag.UserID">Настройка прав пользователей</a></li>
                </ul>
            </nav>
        </div>
        <div class="mainstyle">
            @if (ViewBag.Empty == "true")
        {
            <p>У вас нет еще ни одного заказа.</p>
    }
    else
    {
        <h2>Актуальные заказы</h2>
        <table style="width: 95%; border: 1px solid gray" border="1">
            <tr>
                <th style="width: 10%">Номер заказа</th>
                <th style="width: 10%">Время оформления</th>
                <th style="width: 10%">Время готовности заказа</th>
                <th style="width: 10%">Упаковка заказа</th>
                <th style="width: 10%">Статус</th>
                <th style="width: 10%">Стоимость</th>
                <th style="width: 30%">Заметки</th>
                <th style="width: 10%">Товары в заказе</th>
            </tr>
            @foreach (var order in ViewBag.Orders)
        {
            <tr class="tr" value="@order.OrderID">
                <td>@order.NumberOrder</td>
                <td>@order.OrderTime</td>
                <td>@order.ReadyTime</td>
                @if (@order.WhereEat == false)
            {
                <td><p>С собой</p></td>
        }
        else
        {
            <td><p>На месте</p></td>
    }
                @if (order.Status == 0)
            {
                <td>
                    <select id="status_@order.OrderID" class="status" name="status" required>
                        <option id="0" value="0" selected="">Обработка</option>
                        <option id="1" value="1">Подтвержден</option>
                        <option id="2" value="2">Ожидает выдачи</option>
                        <option id="3" value="3">Выполнен</option>
                        <option id="4" value="4">Удален</option>
                    </select>
                </td>
        }
        else if (order.Status == 1)
        {
            <td>
                <select id="status_@order.OrderID" class="status" name="status" required>
                    <option id="0" value="0">Обработка</option>
                    <option id="1" value="1" selected="">Подтвержден</option>
                    <option id="2" value="2">Ожидает выдачи</option>
                    <option id="3" value="3">Выполнен</option>
                    <option id="4" value="4">Удален</option>
                </select>
            </td>
    }
    else if (order.Status == 2)
    {
        <td>
            <select id="status_@order.OrderID" class="status" name="status" required>
                <option id="0" value="0">Обработка</option>
                <option id="1" value="1">Подтвержден</option>
                <option id="2" value="2" selected="">Ожидает выдачи</option>
                <option id="3" value="3">Выполнен</option>
                <option id="4" value="4">Удален</option>
            </select>
        </td>
}
else if (order.Status == 3)
{
    <td>
        <select id="status_@order.OrderID" class="status" name="status" required>
            <option id="0" value="0">Обработка</option>
            <option id="1" value="1">Подтвержден</option>
            <option id="2" value="2">Ожидает выдачи</option>
            <option id="3" value="3" selected="">Выполнен</option>
            <option id="4" value="4">Удален</option>
        </select>
    </td>
}
else if (order.Status == 4)
{
    <td>
        <select id="status_@order.OrderID" class="status" name="status" required>
            <option id="0" value="0">Обработка</option>
            <option id="1" value="1">Подтвержден</option>
            <option id="2" value="2">Ожидает выдачи</option>
            <option id="3" value="3">Выполнен</option>
            <option id="4" value="4" selected="">Удален</option>
        </select>
    </td>
}
                <td><p>@order.Sum</p></td>
                <td><p>@order.Notes</p></td>
                <td><a href="../Admin/ViewProducts?OrderId=@order.OrderID" class="but">Подробнее</a></td>
            </tr>
    }
        </table>
}
        </div>
        <script>
            $(".status").change (function () {
                var st = $(this).val();
                var id = $(this).closest('.tr').attr('value');
                $.ajax({
                    url: "../api/Order?status=" + st + "&order_id=" + id,
                    type: "POST",
                    dataType: "text"
                })
            });

            /*
            function refresh() {
                alert('Привет');
            }

            setTimeout(refresh, 5000);
            */
        </script>
    </div>
</body>
</html>
